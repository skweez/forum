<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
function renderDiscussion(discussion) {
	$('#discussions').append('<li><a href="discussion.html?id='+discussion.id+'">'+discussion.title+'</a></li>');
}

function reloadDiscussions() {
	$('#discussions').empty();
	$.getJSON('api/discussions', function(discussions) {
		$.each(discussions, function(i, discussion) {
			renderDiscussion(discussion);
		});
	});
}

$( document ).ready(function() {
	
	reloadDiscussions();
	
	$("#newDiscussionForm").submit(function(event) {
		 
		  /* stop form from submitting normally */
		  event.preventDefault();
		 
		  /* Send the data using post */
		  // TODO need to find a cleaner way to create the JSON
		  var json = "{Discussion:{"
			  + $("#newDiscussionForm").serialize()
			  + "}}";
		  var posting = $.post("api/discussions", json);
		  
		  posting.done(function( data, textStatus, jqXHR ) {
			  var location = jqXHR.getResponseHeader("Location");
			  $.getJSON(location, function(discussion) {
				  renderDiscussion(discussion);
			  });
		  });
	});
		  
});
</script>
</head>
<body>
<h1>Latest Discussions</h1>
<ul id="discussions">
</ul>
<form method="POST" action="api/discussions" id="newDiscussionForm">
Titel: <input type="text" name="title">
<input type="submit" value="Speichern">
</form>
</body>
</html>